language: javascript
sudo: false

before_install:
  - rvm install 2.2.4

install:
  - npm install
  - gem install bundler
  - bundle install

before_script:
  # Install gulp cli to ensure gulp command can be run on travis CI
  - npm install -g gulp-cli

script: "gulp jekyll"


before_deploy:
  - git config --local user.name "Adam clone"
  - git config --local user.email "adam@grana.com"
  - git tag "$(date +'%Y%m%d')-$(git log --format=%h -1)"

deploy:
  - provider: pages
    skip_cleanup: true
    email: adam@grana.com
    name: Adam clone
    local_dir: docs
    github_token: $GITHUB_TOKEN
    on:
      branch: master
  - provider: releases
    api_key:
      secure: $GITHUB_TOKEN
    file_glob: true
    file: ./*
    skip_cleanup: true
    on:
      branch: M2-3012

env:
  global:
    secure: "mDzTGe5fH9Jv165UTrefgSzOVjCbfT4+u28d8DfxcZXbEL5VRcVMd1NGuKwtOsvzWsaa5tHC67FCZI4u8Ns+Wc9xu53O0zZC/Y0+GYpkqTVR4GYKE8UJFxQ+A0Ti+u37oYwcbOENT9BE8c2rezK+LX4vX57U+AQxqVuqIkDrUjVZUbQTIR1k1f4wPQJ1SUxeVeptwmniwoAilMMnoAaKoDw24/cZy5KQV74L1gHvIigFUtLAoCcwnaAvhlX1rIHAbuqJnfFDTqpPdtx5MHqNFj4jG9StF+co3EaynlA2hECqOzykYpTY+XER8PENwTiQQ+Mfka7TG34yuE6jWlPISf96EGkUbjzCOfuT2hIYNqIIxK0xgpr/G0dX9s7QtafVLquu576aKAYfznDkrBSeKAEnSs5EhSpy50OF0BdLR/LLoEnifwyT2dfYZYz0soinJIPrNvyhyNkzRyBim6TKCyxR+o9YEtqFPphGEmkGkththDVZQvFVXb7QyPgqx/pZIua8utdyBwRErTEPnZPXShA6RFvX1zc3MSlko1a/Pbd6QGTJFQH06/MvTR4GCM5Yel4chT8XqCgwqqbxHeRrb3K5BooIvIgsS/Jv7dRpCGVCKdMEI2WtAJqu9BQ9VKy1qhTPjKvuQvtGrn4/iyRTA5O36qV2FDM6FdCcO+2T9lM="
